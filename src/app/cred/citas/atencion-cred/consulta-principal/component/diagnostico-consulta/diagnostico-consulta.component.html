<div class="card">
  <div class="col-12">
    <p-table
      [value]="tablaResumenDx"
      responsiveLayout="scroll"
      [(selection)]="selectedProducts"
      [loading]="loading"
      [rowHover]="true"
      styleClass="p-datatable-gridlines"
    >
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between">
          <div class="table-header mt-2">
            RESUMEN DE RESULTADOS DE EVALUACIONES - TESTS - TAMIZAJES -
            INMUNIZACIONES - LABORATORIO
          </div>
          <div>
            <button
              pButton
              pRipple
              label="Agregar a Diagnósticos"
              icon="pi pi-plus"
              class="p-button-danger"
              (click)="agregarToDx()"
              [disabled]="!selectedProducts || !selectedProducts.length"
            ></button>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th style="text-align: center" class="font-2">Nro</th>
          <!--                    <th style="text-align: center" class="font-2">EDAD</th>-->
          <th style="text-align: center" class="font-2">NOMBRE</th>
          <th style="text-align: center" class="font-2">EVALUACION</th>
          <th style="text-align: center" class="font-2">RESULTADO</th>
          <!--                    <th style="width: 3rem">ESTADO</th>-->
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-listaResumen let-rowIndex="rowIndex">
        <tr
          class="p-selectable-row"
          [ngClass]="{
            fondoamarillo: listaResumen.nombre === 'INMUNIZACIONES',
            fondoverde: listaResumen.nombre === 'TAMIZAJES',
            fondoceleste: listaResumen.nombre === 'EVALUACIONES O TEST',
            fondogris: listaResumen.nombre === 'LABORATORIO',
            fondoSuplementacion: listaResumen.nombre === 'MNM'
          }"
        >
          <td style="text-transform: uppercase; text-align: center">
            {{ rowIndex + 1 }}
          </td>
          <!--                    <td style="text-transform:uppercase;text-align: center" >-->
          <!--                        {{this.dataConsulta.anio }} (años)    {{this.dataConsulta.mes }} (meses)    {{this.dataConsulta.dia }} (dias)-->
          <!--                    </td>-->
          <td style="text-transform: uppercase; text-align: center">
            {{ listaResumen.nombre }}
          </td>
          <td style="text-transform: uppercase; text-align: center">
            {{ listaResumen.evaluacion }}
          </td>
          <td
            style="text-transform: uppercase; text-align: center"
            [ngClass]="{
              rojo:
                listaResumen.resultado === 'POSITIVO' ||
                listaResumen.resultado == 'RETRASO' ||
                listaResumen.resultado ==
                  'NINO CON ALIMENTACION COMPLEMENTARIA INADECUADA' ||
                listaResumen.resultado == 'Sobrepeso' ||
                listaResumen.resultado == 'Riesgo microcefalia' ||
                listaResumen.resultado == 'Desnutrición'
            }"
          >
            {{ listaResumen.resultado }}
          </td>
          <!--                    <td>-->
          <!--                        <p-inputSwitch>{{checked[rowIndex]}}</p-inputSwitch>-->
          <!--                    </td>-->
          <td>
            <p-tableCheckbox [value]="listaResumen"></p-tableCheckbox>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <br />

  <div class="col-12 lg:col-12 md:col-12">
    <p-table
      [value]="diagnosticos"
      [rowHover]="true"
      styleClass="p-datatable-gridlines"
      responsiveLayout="scroll"
      [rows]="5"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[5, 10, 15]"
      [paginator]="true"
      currentPageReportTemplate="Mostrando {first} al {last} de {totalRecords} entradas"
      [filterDelay]="0"
    >
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between">
          <div class="table-header mt-2">
            1. DIAGNÓSTICO NOSOLÓGICO O SINDRÓMICO
          </div>
          <div>
            <button
              pButton
              pRipple
              label="Agregar"
              icon="pi pi-plus-circle"
              class="guardar mr-2"
              style="background-color: #0c3866"
              (click)="openDiagnostico()"
            ></button>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th style="text-align: center" class="font-2">Nro</th>
          <th style="text-align: center" class="font-2">
            CODIGO DE PRESTACION
          </th>
          <th style="text-align: center" class="font-2">
            NOMBRE SUBTITULO UPS
          </th>
          <th style="text-align: center" class="font-1">DIAGNÓSTICO SIS</th>
          <th style="text-align: center" class="font-2">CIE 10 SIS</th>
          <th style="text-align: center" class="font-1">DIAGNÓSTICO HIS</th>
          <th style="text-align: center" class="font-2">CIE 10 HIS</th>
          <th style="text-align: center" class="font-2">TIPO</th>
          <th style="text-align: center" class="font-2">FACTOR CONDICIONAL</th>
          <th style="text-align: center" class="font-2">LAB</th>
          <th style="text-align: center" class="font-2">ACCIÓN</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
        <tr>
          <td style="text-align: center" class="font-2">{{ rowIndex + 1 }}</td>
          <td style="text-align: center">{{ rowData.codPrestacion }}</td>
          <td style="text-align: center">{{ rowData.nombreUPSaux }}</td>
          <td style="text-align: center">{{ rowData.diagnosticoSIS }}</td>
          <td style="text-align: center">{{ rowData.cie10SIS }}</td>
          <td style="text-align: center">{{ rowData.diagnosticoHIS }}</td>
          <td style="text-align: center">{{ rowData.cie10HIS }}</td>
          <td style="text-align: center">{{ rowData.tipo }}</td>
          <td style="text-align: center">{{ rowData.factorCondicional }}</td>
          <td style="text-align: center">{{ rowData.lab }}</td>
          <td style="text-align: center">
            <button
              pButton
              pRipple
              icon="pi pi-pencil"
              class="p-button-rounded m-1"
              (click)="editarDx(rowData, rowIndex)"
              pTooltip="Editar"
            ></button>
            <button
              pButton
              pRipple
              icon="pi pi-trash"
              class="p-button-rounded p-button-danger m-1"
              (click)="eliminarDiagnostico(rowIndex)"
              pTooltip="Eliminar"
            ></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
<div id="opc">
  <div class="speeddial-circle-demo">
    <div class="speeddial-semi-circle">
      <p-speedDial
        showIcon="pi pi-desktop"
        hideIcon="pi pi-angle-double-down"
        [model]="tooltipItems"
        radius="80"
        direction="left"
        type="semi-circle"
      ></p-speedDial>
    </div>
  </div>
</div>
<!-- End Datos generales -->
<!-- Dialog Interconsulta --->
<p-dialog
  header="INTERCONSULTA"
  [(visible)]="dialogInterconsulta"
  [modal]="true"
  [style]="{ width: '60%' }"
  [draggable]="false"
  [resizable]="false"
>
  <form [formGroup]="formInterconsulta">
    <div class="grid align-items-center">
      <div class="col-12 flex align-items-center">
        <div class="col-2 md:col-2">Fecha:</div>
        <div class="col-10 md:col-10 p-fluid">
          <p-calendar
            class="w-full"
            [ngModel]="fecha"
            formControlName="fecha"
            [showIcon]="true"
            inputId="icon"
          ></p-calendar>
        </div>
      </div>
      <div class="col-12 flex align-items-center">
        <div class="col-6 md:col-2">Motivo:</div>
        <div class="col-6 md:col-10">
          <textarea
            class="inputfield w-full"
            formControlName="motivo"
            pInputTextarea
          ></textarea>
        </div>
      </div>
      <div class="col-6 flex align-items-center">
        <div class="col-3 md:col-3 p-fluid">Servicio:</div>
        <div class="col-9 md:col-9 p-fluid">
          <p-dropdown
            class="w-full"
            [options]="servicios"
            formControlName="servicio"
            placeholder="Seleccione un servicio"
            optionLabel="nombreUPS"
            optionValue="nombreUPS"
            [showClear]="false"
            (onChange)="ListaServicios()"
          >
          </p-dropdown>
        </div>
      </div>
      <div class="col-4 flex align-items-center">
        <div class="col-6 md:col-6 p-fluid">Nivel Urgencia:</div>
        <div class="col-6 md:col-6 p-fluid">
          <p-dropdown
            class="w-full"
            [options]="urgencia"
            formControlName="urgencia"
            optionLabel="name"
            optionValue="code"
          ></p-dropdown>
        </div>
      </div>
      <div class="col-2 p-fluid">
        <p-button
          class="w-full button-agregar"
          style="background-color: #0c3866"
          label="Agregar"
          icon="pi pi-plus"
          [loading]="loadings"
          (onClick)="agregarInterconsulta()"
        ></p-button>
      </div>
    </div>
  </form>
  <p-table
    class="table-over"
    [value]="listInterconsulta"
    #dt
    styleClass="p-datatable-gridlines"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [paginator]="true"
    [autoLayout]="true"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} entradas"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="text-align: center" class="font-2">Nro</th>
        <th style="text-align: center" class="font-2">CITA</th>
        <th style="text-align: center" class="font-2">MOTIVO</th>
        <th style="text-align: center" class="font-2">SERVICIO</th>
        <th style="text-align: center" class="font-2">NIVEL</th>
        <th style="text-align: center" class="font-2">ACCIÓN</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
      <tr>
        <td style="text-align: center" class="font-2">{{ rowIndex + 1 }}</td>
        <td style="text-align: center">{{ rowData.fecha }}</td>
        <td style="text-align: center">{{ rowData.motivo }}</td>
        <td style="text-align: center">{{ rowData.servicio }}</td>
        <td style="text-align: center">{{ rowData.nivelUrgencia }}</td>
        <td style="text-align: center">
          <button
            pButton
            pRipple
            icon="pi pi-trash"
            class="p-button-rounded p-button-danger m-1"
            (click)="eliminarInterconsulta(rowData.idCupos,rowIndex)"
            pTooltip="Eliminar"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <!--<ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      label="Cancelar"
      style="background-color: #0c3866"
      class="button-cancelar"
      icon="pi pi-times"
      (click)="cancelInterconsulta()"
    ></button>
    <button
      class="button-agregar"
      icon="pi pi-save"
      style="background-color: #0c3866"
      pButton
      type="button"
      label="Guardar"
      (click)="saveInterconsulta()"
    ></button>
  </ng-template>-->
</p-dialog>

<!-- Diagnóstico --->
<p-dialog
  header="INGRESAR UN DIAGNOSTICO"
  [(visible)]="diagnosticoDialog"
  [modal]="true"
  [style]="{ width: '80%', height: '70%' }"
  [draggable]="false"
  [resizable]="false"
>
  <div class="card m-2" *ngIf="checked">
    <p-toolbar>
      <div class="p-toolbar-group-left">
        <h3>
          RESUMEN DE EVALUACIONES, EXAMENES AUXILIARES Y TEST SELECCIONADOS
        </h3>
      </div>
    </p-toolbar>

    <p-table [value]="selectedProducts" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>NOMBRE</th>
          <th>EVALUACION</th>
          <th>RESULTADO</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-dxs>
        <tr style="text-transform: uppercase; text-align: center">
          <td>{{ dxs.nombre }}</td>
          <td>{{ dxs.evaluacion }}</td>
          <td>{{ dxs.resultado }}</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <form [formGroup]="formDiagnostico">
    <div class="grid mt-2">
      <div class="col-12 p-fluid">
        <label>Prestacion:</label>
        <p-dropdown
          [options]="ListaPrestacion"
          formControlName="prestacion"
          placeholder="Seleccionar un Diagnostico"
          optionLabel="descripcion"
          (onChange)="onChangePrestacion()"
        >
          <ng-template let-prestaciones pTemplate="item">
            <div class="flex align-items-center">
              <div>
                {{ prestaciones.codigo }}-{{ prestaciones.descripcion }}
              </div>
            </div>
          </ng-template>
        </p-dropdown>
      </div>

      <div class="col-3 p-fluid">
        <label>NOMBRE UPS:</label>
        <!--<input
          type="text"
          style="text-transform: uppercase"
          pInputText
          class="inputfield p-fluid w-full"
          formControlName="nombreUPS"
        />-->
        <p-dropdown
          [options]="listaUpsHis"
          id="nombreUPS"
          formControlName="nombreUPS"
          optionLabel="nombreUPS"
          optionValue="nombreUPS"
          defaultLabel="Seleccione:"
          class="inputfield p-fluid w-full"
        >
        </p-dropdown>
      </div>
      <div class="col-3 p-fluid">
        <label>SUBTITULO UPS:</label>
        <p-dropdown
          inputId="dropdown"
          [options]="listaUpsAuxHis"
          id="nombreUPSaux"
          formControlName="nombreUPSaux"
          optionLabel="nombre"
          placeholder="Seleccionar"
          defaultLabel="Seleccione:"
          appendTo="body"
          class="inputfield p-fluid w-full"
        >
        </p-dropdown>
      </div>
      <div class="col-3 p-fluid">
        <label>LAB:</label>
        <input
          type="text"
          style="text-transform: uppercase"
          pInputText
          class="inputfield p-fluid w-full"
          formControlName="lab"
        />
      </div>

      <div class="col-3 p-fluid">
        <label>Tipo diagnostico:</label>
        <p-dropdown
          inputId="dropdown"
          [options]="tipoList"
          formControlName="tipoDiagnostico"
          placeholder="Seleccione"
          optionLabel="label"
          optionValue="value"
          defaultLabel="Seleccione:"
          appendTo="body"
          class="inputfield p-fluid w-full"
        >
        </p-dropdown>
      </div>

      <div class="col-12 md:col-6 lg:col-6">
        <p-fieldset legend="DIAGNOSTICO SIS">
          <div class="grid mt-2">
            <div class="col-12 p-fluid">
              <p-dropdown
                [options]="listaDeCIESIS"
                formControlName="buscarDxSIS"
                placeholder="Seleccionar un Diagnostico"
                optionLabel="diagnostico"
                (onChange)="selectDxSIS($event)"
              >
                <ng-template let-diagnosticos pTemplate="item">
                  <div class="flex align-items-center">
                    <div>
                      {{ diagnosticos.grupo }}-{{ diagnosticos.diagnostico }}-{{
                        diagnosticos.criterio
                      }}
                    </div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </div>
          <div class="grid mt-2">
            <div class="col-12 p-fluid">
              <textarea
                style="text-transform: uppercase"
                rows="5"
                cols="30"
                pInputTextarea
                formControlName="diagnosticoSIS"
              ></textarea>
            </div>
          </div>
          <div class="grid mt-2">
            <div class="col-12 p-fluid">
              <label>CIE 10: </label>
            </div>
            <div class="col-12 p-fluid">
              <p-dropdown
                [options]="listaDeCIESIS"
                formControlName="cie10SIS"
                appendTo="body"
                optionLabel="cie10"
                class="inputfield p-fluid w-full"
                placeholder="Seleccione"
                (onChange)="selectedOption($event)"
              ></p-dropdown>
              <!--                            <input style="text-transform:uppercase"   pInputText formControlName="cie10SIS">-->
            </div>
          </div>
        </p-fieldset>
      </div>
      <div class="col-6">
        <p-fieldset legend="DIAGNOSTICO HIS">
          <div class="grid mt-2">
            <div class="col-12 p-fluid">
              <p-autoComplete
                [suggestions]="listaDeCIEHIS"
                (completeMethod)="filterCIE10($event)"
                appendTo="body"
                field="descripcionItem"
                [minLength]="1"
                class="areaText"
                class="inputfield p-fluid w-full"
                formControlName="buscarDxHIS"
                (onSelect)="selectedDxHIS($event)"
                [dropdown]="true"
                placeholder="Seleccionar un Diagnostico"
              >
              </p-autoComplete>
            </div>
          </div>
          <div class="grid mt-2">
            <div class="col-12 p-fluid">
              <textarea
                rows="5"
                cols="30"
                pInputTextarea
                formControlName="diagnosticoHIS"
              ></textarea>
            </div>
          </div>
          <div class="grid mt-2">
            <div class="col-12 p-fluid">
              <label>CIE 10: </label>
            </div>
            <div class="col-12 p-fluid">
              <p-autoComplete
                [suggestions]="listaDeCIEHIS"
                (completeMethod)="filterCIE10($event)"
                appendTo="body"
                field="codigoItem"
                [minLength]="1"
                class="areaText"
                class="inputfield p-fluid w-full"
                formControlName="cie10HIS"
                (onSelect)="selectedDxHIS($event)"
                [dropdown]="true"
                placeholder="Seleccionar un Diagnostico"
              >
              </p-autoComplete>
              <!--                     <input pInputText formControlName="cie10HIS">-->
            </div>
          </div>
        </p-fieldset>
      </div>
      <div class="col-12">
        <div class="grid mt-2">
          <div class="col-12 p-fluid">
            <label>FACTOR CONDICIONAL: </label>
          </div>
          <div class="col-12 p-fluid">
            <input
              style="text-transform: uppercase"
              pInputText
              formControlName="factorCondicional"
            />
          </div>
        </div>
      </div>
    </div>
  </form>
  <ng-template pTemplate="footer">
    <button
      *ngIf="!isUpdate"
      class="button-agregar"
      icon="pi pi-save"
      pButton
      type="button"
      label="Guardar"
      (click)="getDatatoSaveDx()"
    ></button>
    <button
      *ngIf="isUpdate"
      class="button-agregar"
      icon="pi pi-pencil"
      pButton
      type="button"
      label="Editar"
      (click)="getDatatoEditDx()"
    ></button>
    <button
      pButton
      type="button"
      label="Cancelar"
      class="button-cancelar"
      icon="pi pi-times"
      (click)="cancelDiagnostico()"
    ></button>
  </ng-template>
</p-dialog>
