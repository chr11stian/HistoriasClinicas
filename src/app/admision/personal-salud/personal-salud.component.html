<!--TABLA PERSONAL-->
<div class="p-card">
  <p-toolbar styleClass="p-mb-4">
    <ng-template pTemplate="left">
      <h3 class="p-m-0">Lista de Personal de Salud</h3>
    </ng-template>

    <ng-template pTemplate="right" class="button">
      <button
        pButton
        pRipple
        label="Nuevo"
        icon="pi pi-plus"
        class="p-button-danger p-mr-2"
        (click)="openNew()"
      ></button>
      <button
        pButton
        pRipple
        label="Exportar"
        icon="pi pi-upload"
        class="p-button-primary"
      ></button>
    </ng-template>
  </p-toolbar>
  <p-table
    [value]="data"
    #dt
    [globalFilterFields]="['nombres', 'nroDoc', 'apPaterno']"
    styleClass="p-datatable-gridlines   "
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [paginator]="true"
    [autoLayout]="true"
    currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} entradas"
  >
    <ng-template pTemplate="caption">
      <div class="p-d-flex p-ai-center p-jc-between">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input
            pInputText
            type="text"
            (input)="dt.filterGlobal($event.target.value, 'contains')"
            placeholder="Buscar..."
          />
        </span>
      </div>
    </ng-template>
    <ng-template pTemplate="header" styleClass="p-datatable-gridlines">
      <tr>
        <th style="text-align: center">Nro</th>
        <th style="text-align: center">DNI</th>
        <th style="text-align: center">Apellidos</th>
        <th style="text-align: center">Nombres</th>
        <!-- <th style="text-align: center">Fecha Nacimiento</th> -->
        <!-- <th style="text-align: center">Sexo</th> -->
        <th style="text-align: center">Tipo Personal</th>
        <th style="text-align: center">Colegio Profesional</th>
        <!-- <th style="text-align: center">Colegiatura</th> -->
        <th style="text-align: center">Tipo Contrato</th>
        <!-- <th style="text-align: center">EESS</th> -->
        <th style="text-align: center">Estado</th>
        <th style="text-align: center">Especialidad</th>
        <th style="text-align: center">Rol</th>
        <th style="text-align: center; width: 120px">Acción</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
      <tr style="text-align: center">
        <td style="text-align: center">{{ rowIndex + 1 }}</td>
        <td style="text-align: center">{{ rowData.nroDoc }}</td>
        <td style="text-align: center">
          {{ rowData.apePaterno + " " + rowData.apeMaterno }}
        </td>
        <td style="text-align: center">
          {{ rowData.primerNombre + " " + rowData.otrosNombres }}
        </td>
        <!-- <td style="text-align: center">{{ rowData.fechaNacimiento | date: "dd/MM/yyyy" }}</td> -->
        <!-- <td style="text-align: center">{{ rowData.sexo }}</td> -->
        <td style="text-align: center">
          {{ rowData.tipoPersonal ? rowData.tipoPersonal.nombre : "" }}
        </td>
        <td style="text-align: center">
          {{
            rowData.colegioProfesional
              ? rowData.colegioProfesional[0].nombre
              : ""
          }}
        </td>
        <!-- <td style="text-align: center">{{ rowData.colegiatura }}</td> -->
        <td style="text-align: center">{{ rowData.contratoAbreviatura }}</td>
        <!-- <td style="text-align: center">{{ rowData.detalleIpress ? rowData.detalleIpress[0].eess : "" }}</td> -->
        <td style="text-align: center">
          <p-tag
            *ngIf="rowData.estado"
            styleClass="p-mr-2"
            severity="success"
            value="Activo"
            [rounded]="true"
          ></p-tag>
          <p-tag
            *ngIf="!rowData.estado"
            styleClass="p-mr-2"
            severity="danger"
            value="Inactivo"
            [rounded]="true"
          ></p-tag>
        </td>

        <td style="text-align: center">
          <button
            pButton
            pRipple
            icon="pi pi-briefcase"
            class="p-button-rounded p-button-help"
            (click)="newEspecialidad(rowData)"
          ></button>
        </td>
        <td style="text-align: center">
          <button
            pButton
            pRipple
            icon="pi pi-sitemap"
            class="p-button-rounded p-button-help"
            (click)="newRolX(rowData)"
          ></button>
        </td>
        <td style="text-align: center; display: flex">
          <button
            pButton
            pRipple
            icon="pi pi-pencil"
            class="p-button-rounded m-1"
            (click)="editar(rowData)"
          ></button>
          <button
            pButton
            (click)="eliminar(rowData)"
            pTooltip="Eliminar"
            pRipple
            type="button"
            icon="pi pi-trash"
            class="p-button-rounded p-button-danger m-1"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!--PERSONAL DIALOG-->
<p-dialog
  [(visible)]="personalDialog"
  [style]="{ width: '1300px', height: '1200px' }"
  [modal]="true"
  styleClass="p-fluid"
  autoZIndex
>
  <ng-template pTemplate="header">
    <h3 class="m-0">{{ titulo() }}</h3>
  </ng-template>

  <ng-template pTemplate="body">
    <form [formGroup]="form">
      <div>
        <label>DNI o otra Identificacion:</label>
        <div class="grid">
          <div class="p-field col-2 pr-1">
            <p-dropdown
              *ngIf="!isUpdate"
              [showTransitionOptions]="'300ms'"
              dropdownIcon="pi pi-chevron-right"
              inputId="dropdown"
              [options]="docList"
              formControlName="tipoDoc"
              optionLabel="abreviatura"
              optionValue="abreviatura"
              placeholder="Tipo Documento"
              id="docid"
              class="inputRedondo"
            >
            </p-dropdown>
            <p-dropdown
              *ngIf="isUpdate"
              [showTransitionOptions]="'300ms'"
              dropdownIcon="pi pi-chevron-right"
              inputId="dropdown"
              [options]="docList"
              formControlName="tipoDoc"
              optionLabel="abreviatura"
              optionValue="abreviatura"
              id="docid"
              class="inputRedondo"
            >
            </p-dropdown>
          </div>
          <div class="p-inputgroup col-2">
            <input
              type="text"
              pInputText
              formControlName="nroDoc"
              placeholder="Nro Documento"
            />
            <button
              type="button"
              pButton
              pRipple
              icon="pi pi-search"
              (click)="traerData()"
              class="p-button-outlined p-button-secondary"
            ></button>
          </div>
        </div>
      </div>
      <p-divider align="left">
        <div class="p-d-inline-flex p-ai-center">
          <i class="pi pi-angle-double-right p-mr-2"></i>
          <b> Datos Personales</b>
        </div>
      </p-divider>
      <br />
      <div class="grid">
        <label class="col-9 p-0 pl-2">Apellidos y Nombres:</label>
        <label class="col-3 p-0 pl-2">Sexo:</label>
      </div>
      <div class="grid">
        <div class="p-field col-3">
          <input
            type="text"
            class="inputRedondo"
            placeholder="Ap. Paterno"
            pInputText
            formControlName="apePaterno"
            required
          />
        </div>

        <div class="p-field col-3">
          <input
            type="text"
            class="inputRedondo"
            placeholder="Ap. Materno"
            pInputText
            formControlName="apeMaterno"
            required
          />
        </div>

        <div class="p-field col-3">
          <input
            type="text"
            class="inputRedondo"
            placeholder="Nombres"
            pInputText
            formControlName="nombres"
            required
          />
        </div>
        <div class="p-field col-3">
          <input
            type="text"
            class="inputRedondo"
            placeholder="Sexo"
            pInputText
            formControlName="sexo"
            required
          />
        </div>
      </div>

      <div class="grid">
        <div class="p-field col-3">
          <label>Fecha Nacimiento:</label>
          <input
            class="inputRedondo"
            type="date"
            placeholder="Fecha Nacimiento"
            pInputText
            formControlName="fechaNacimiento"
            required
          />
        </div>
        <div class="p-field col-3">
          <label>Estado Civil:</label>
          <input
            class="inputRedondo"
            type="text"
            placeholder="Estado Civil"
            pInputText
            formControlName="estadoCivil"
            required
          />
        </div>
        <div class="p-field col-6">
          <label>Domicilio Actual:</label>
          <input
            class="inputRedondo"
            type="text"
            placeholder="Domicilio Actual"
            pInputText
            formControlName="domicilioActual"
            required
          />
        </div>
      </div>
      <div class="grid">
        <div class="p-field col-3">
          <label>Nacionalidad:</label>
          <input
            class="inputRedondo"
            type="text"
            placeholder="Nacionalidad"
            pInputText
            formControlName="nacionalidad"
            required
          />
        </div>
        <div class="p-field col-3">
          <label>Departamento:</label>
          <input
            class="inputRedondo"
            type="text"
            placeholder="Departamento"
            pInputText
            formControlName="departamento"
            required
          />
        </div>
        <div class="p-field col-3">
          <label>Provincia:</label>
          <input
            class="inputRedondo"
            type="text"
            placeholder="Provincia"
            pInputText
            formControlName="provincia"
            required
          />
        </div>
        <div class="p-field col-3">
          <label>Distrito:</label>
          <input
            class="inputRedondo"
            type="text"
            placeholder="Distrito"
            pInputText
            formControlName="distrito"
            required
          />
        </div>
      </div>
      <p-divider align="left">
        <div class="p-d-inline-flex p-ai-center">
          <i class="pi pi-angle-double-right p-mr-2"></i>
          <b> Datos Profesionales</b>
        </div>
      </p-divider>
      <br />
      <div class="grid">
        <div class="p-field col-4 pt-0">
          <label>Colegio Profesional:</label>
          <p-dropdown
            *ngIf="!isUpdate"
            placeholder="Colegio Profesional"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="colegiosList"
            formControlName="colegioProfesional"
            optionLabel="nombre"
            optionValue="codigo"
            id="despecid"
            required
          >
          </p-dropdown>
          <p-dropdown
            *ngIf="isUpdate"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="colegiosList"
            formControlName="colegioProfesional"
            optionLabel="nombre"
            optionValue="codigo"
            id="despecid"
            required
          >
          </p-dropdown>
        </div>
        <div class="p-field col-4 pt-0">
          <label>Colegiatura:</label>
          <input
            class="inputRedondo"
            type="text"
            placeholder="Colegiatura"
            pInputText
            formControlName="colegiatura"
            required
          />
        </div>
        <div class="p-field col-4 pt-0">
          <label>Tipo de Personal:</label>
          <p-dropdown
            *ngIf="!isUpdate"
            placeholder="Tipo de Personal"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="tiposPersonalList"
            formControlName="tipoPersonal"
            optionLabel="nombre"
            optionValue="nombre"
            id="tipoid"
            scrollHeight="100px" 
            required
          >
          </p-dropdown>
          <p-dropdown
            *ngIf="isUpdate"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="tiposPersonalList"
            formControlName="tipoPersonal"
            optionLabel="nombre"
            optionValue="nombre"
            id="tipoid"
            scrollHeight="100px" 
            required
          >
          </p-dropdown>
        </div>
      </div>
      <div class="grid">
        <div class="p-field col-4">
          <label>Tipo Contrato:</label>
          <p-dropdown
            *ngIf="!isUpdate"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="tiposContratoList"
            formControlName="contratoAbreviatura"
            optionLabel="abreviatura"
            placeholder="Tipo de Contrato"
            optionValue="abreviatura"
            id="tipoid"
            scrollHeight="80px" 
            required
          >
          </p-dropdown>
          <p-dropdown
            *ngIf="isUpdate"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="tiposContratoList"
            formControlName="contratoAbreviatura"
            optionLabel="abreviatura"
            optionValue="abreviatura"
            id="tipoid"
            scrollHeight="80px" 
            required
          >
          </p-dropdown>
        </div>
        <div class="p-field col-4">
          <label>Ipress:</label>
          <p-dropdown
            *ngIf="!isUpdate"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="ipressList"
            formControlName="detalleIpress"
            optionLabel="nombreEESS"
            placeholder="Seleccione Ipress"
            optionValue="id"
            scrollHeight="80px" 
            required
          >
          </p-dropdown>
          <p-dropdown
            *ngIf="isUpdate"
            class="inputRedondo"
            [showTransitionOptions]="'300ms'"
            dropdownIcon="pi pi-chevron-down"
            inputId="dropdown"
            [options]="ipressList"
            formControlName="detalleIpress"
            optionLabel="nombreEESS"
            [disabled]="true"
            optionValue="id"
            scrollHeight="80px" 
            required
          >
          </p-dropdown>
        </div>
        <div class="p-field col-4">
          <label>Fecha Inicio:</label>
          <input
            class="inputRedondo"
            type="date"
            placeholder="Fecha Inicio"
            pInputText
            formControlName="fechaInicio"
            required
          />
        </div>
      </div>
      <div class="grid">
        <div class="p-field col-4"></div>
        <div class="p-field col-4">
          <label>Estado:</label>
          <p-selectButton
            [options]="stateOptions"
            formControlName="estado"
            optionLabel="label"
            optionValue="value"
          ></p-selectButton>
        </div>
        <div class="p-field col-4"></div>
      </div>
    </form>
  </ng-template>

  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      label="Cancelar"
      class="p-button-danger"
      (click)="canceled()"
    ></button>
    <button
      *ngIf="!isUpdate"
      pButton
      type="button"
      label="Guardar"
      (click)="saveForm()"
    ></button>
    <button
      *ngIf="isUpdate"
      pButton
      type="button"
      label="Guardar"
      (click)="editarDatos()"
    ></button>
  </ng-template>
</p-dialog>

<!--ESPECIALIDAD DIALOG-->
<p-dialog
  [(visible)]="personalEspecialidadDialog"
  [style]="{ width: '1200px' }"
  [modal]="true"
  styleClass="p-fluid "
  autoZIndex
>
  <ng-template pTemplate="body">
    <div class="grid">
      <div class="col-4 mt-2">
        <p-card class="m-0">
          <h2>{{ tituloEspecialidad() }}</h2>
          <form [formGroup]="formEspecialidad">
            <div class="p-fluid grid flex justify-content-center">
              <div class="p-field col-12 md:col-12">
                <label id="nombre">Especialidad:</label>
                <p-dropdown
                  *ngIf="!isUpdateEspecialidad"
                  class="inputRedondo"
                  [showTransitionOptions]="'300ms'"
                  dropdownIcon="pi pi-chevron-down"
                  inputId="dropdown"
                  [options]="especialidadesList"
                  formControlName="nombre"
                  optionLabel="nombre"
                  optionValue="nombre"
                  id="tipoid"
                  required
                  placeholder="Selecciones Especialidad"
                >
                </p-dropdown>
                <p-dropdown
                  *ngIf="isUpdateEspecialidad"
                  class="inputRedondo"
                  [showTransitionOptions]="'300ms'"
                  dropdownIcon="pi pi-chevron-down"
                  inputId="dropdown"
                  [options]="especialidadesList"
                  formControlName="nombre"
                  optionLabel="nombre"
                  optionValue="nombre"
                  id="tipoid"
                  required
                >
                </p-dropdown>
              </div>
            </div>
            <div class="p-fluid grid flex justify-content-center">
              <div class="p-field col-12 md:col-12">
                <label id="nroEspe">Nro Especialidad:</label>
                <input
                  type="text"
                  pInputText
                  formControlName="nroEspecialidad"
                  required
                />
              </div>
            </div>
          </form>
          <br />
          <div class="flex justify-content-end">
            <button
              *ngIf="!isUpdateEspecialidad"
              [disabled]="!formEspecialidad.valid"
              pButton
              type="button"
              label="Guardar"
              class="m-1 w-9rem"
              (click)="saveEspecialidad()"
            ></button>
            <button
              *ngIf="isUpdateEspecialidad"
              [disabled]="!formEspecialidad.valid"
              pButton
              type="button"
              label="Guardar"
              class="m-1 w-9rem"
              (click)="saveEdicionEspecialidad()"
            ></button>
            <button
              pButton
              type="button"
              label="Nuevo"
              icon="pi pi-plus"
              (click)="guardarNuevoEspecialidad()"
              pTooltip="Agregar especialidad"
              tooltipPosition="right"
              class="p-button-danger m-1 w-9rem"
              pRipple
            ></button>
          </div>
        </p-card>
      </div>
      <div class="col-8">
        <p-table
          [value]="especialidades"
          #dt
          styleClass="p-datatable-gridlines"
          [rows]="10"
          [rowsPerPageOptions]="[10, 25, 50]"
          [paginator]="true"
          [autoLayout]="true"
          currentPageReportTemplate="Mostrando de {first} a {last} de {totalRecords} entradas"
          [showCurrentPageReport]="true"
        >
          <ng-template pTemplate="caption">
            <div class="flex justify-content-between">
              <h3>Lista de Especialidades de {{ nombrePersonal }}</h3>
            </div>
          </ng-template>
          <ng-template pTemplate="header" styleClass="p-datatable-gridlines">
            <tr>
              <th style="text-align: center">Nro</th>
              <th style="text-align: center">Nombre</th>
              <th style="text-align: center">Nro Especialidad</th>
              <th style="text-align: center; width: 8rem">Estado</th>
              <th style="text-align: center; width: 8rem">Acción</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
            <tr style="text-align: center">
              <td style="text-align: center">{{ rowIndex + 1 }}</td>
              <td style="text-align: center">{{ rowData.nombre }}</td>
              <td style="text-align: center">{{ rowData.nroEspecialidad }}</td>
              <td style="text-align: center">
                <p-tag
                  *ngIf="rowData.estado"
                  styleClass="p-mr-2"
                  severity="success"
                  value="Activo"
                  [rounded]="true"
                ></p-tag>
                <p-tag
                  *ngIf="!rowData.estado"
                  styleClass="p-mr-2"
                  severity="danger"
                  value="Inactivo"
                  [rounded]="true"
                ></p-tag>
              </td>
              <td>
                <button
                  pButton
                  (click)="editarEspecialidad(rowData)"
                  pTooltip="Editar"
                  pRipple
                  type="button"
                  icon="pi pi-pencil"
                  class="p-button-rounded m-1"
                ></button>
                <button
                  pButton
                  (click)="eliminarEspecialidad(rowData)"
                  pTooltip="Eliminar"
                  pRipple
                  type="button"
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-danger m-1"
                ></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      label="Salir"
      class="m-1 w-5rem"
      (click)="close()"
    ></button>
  </ng-template>
</p-dialog>
<!--ROL DIALOG-->
<p-dialog
  [(visible)]="personalRolDialogX"
  [style]="{ width: '1200px' }"
  [modal]="true"
  styleClass="p-fluid "
  autoZIndex
>
  <ng-template pTemplate="body">
    <div class="grid">
      <div class="col-4 mt-2">
        <p-card class="m-0">
          <h2>Ingrese nuevo Rol</h2>
          <form [formGroup]="formRol">
            <div class="p-fluid grid flex justify-content-center">
              <div class="p-field col-12 md:col-12">
                <label id="nroEspe">Nombre Funcion:</label>
                <input
                  type="text"
                  pInputText
                  formControlName="nombreFuncion"
                  required
                />
              </div>
            </div>
            <div class="p-fluid grid flex justify-content-center">
              <div class="p-field col-12 md:col-12">
                <label id="nombre">Ups:</label>
                <p-dropdown
                  *ngIf="!isUpdatRol"
                  class="inputRedondo"
                  [showTransitionOptions]="'300ms'"
                  dropdownIcon="pi pi-chevron-down"
                  inputId="dropdown"
                  [options]="listaUpsX"
                  formControlName="ups"
                  optionLabel="nombreUPS"
                  optionValue="id"
                  id="tipoid"
                  placeholder="Selecciones Especialidad"
                >
                </p-dropdown>
                <p-dropdown
                  *ngIf="isUpdateRol"
                  class="inputRedondo"
                  [showTransitionOptions]="'300ms'"
                  dropdownIcon="pi pi-chevron-down"
                  inputId="dropdown"
                  [options]="listaUpsX"
                  formControlName="ups"
                  optionLabel="id"
                  optionValue="nombre"
                  id="tipoid"
                >
                </p-dropdown>
              </div>
            </div>
          </form>
          <br />
          <div class="flex justify-content-end">
            <button
                    *ngIf="!isUpdateRolX"
                    [disabled]="!formRol.valid"
                    pButton
                    type="button"
                    label="Guardar"
                    class="m-1 w-9rem"
                    (click)="saveRol()"
            ></button>
            <button
                    *ngIf="isUpdateRolX"
                    [disabled]="!formRol.valid"
                    pButton
                    type="button"
                    label="Guardar"
                    class="m-1 w-9rem"
                    (click)="saveEdicionRol()"
            ></button>
            <button
              pButton
              type="button"
              label="Nuevo"
              icon="pi pi-plus"
              (click)="guardarNuevoEspecialidad()"
              pTooltip="Agregar especialidad"
              tooltipPosition="right"
              class="p-button-danger m-1 w-9rem"
              pRipple
            ></button>
          </div>
        </p-card>
      </div>
      <div class="col-8">
        <p-table
            [value]="rolesX"
          #dt
          styleClass="p-datatable-gridlines"
          [rows]="10"
          [rowsPerPageOptions]="[10, 25, 50]"
          [paginator]="true"
          [autoLayout]="true"
          currentPageReportTemplate="Mostrando de {first} a {last} de {totalRecords} entradas"
          [showCurrentPageReport]="true"
        >
          <ng-template pTemplate="caption">
            <div class="flex justify-content-between">
              <h3>Lista de roles de {{ nombrePersonal }}</h3>
            </div>
          </ng-template>
          <ng-template pTemplate="header" styleClass="p-datatable-gridlines">
            <tr>
              <th style="text-align: center">Nro</th>
              <th style="text-align: center">Nombre</th>
              <th style="text-align: center">Rol del Personal</th>
              <th style="text-align: center; width: 8rem">Acción</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
            <tr style="text-align: center">
              <td style="text-align: center">{{ rowIndex + 1 }}</td>
              <td style="text-align: center">{{ rowData.nombreFuncion }}</td>
              <td style="text-align: center">{{ rowData.codUPS }}</td>
              <td>
                <button
                  pButton
                  (click)="editarRolX(rowData)"
                  pTooltip="Editar"
                  pRipple
                  type="button"
                  icon="pi pi-pencil"
                  class="p-button-rounded m-1"
                ></button>
                <button
                  pButton
                  (click)="eliminarRolX(rowData,rowIndex)"
                  pTooltip="Eliminar"
                  pRipple
                  type="button"
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-danger m-1"
                ></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      label="Salir"
      class="m-1 w-5rem"
      (click)="closeRol()"
    ></button>
  </ng-template>
</p-dialog>
